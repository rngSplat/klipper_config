[idle_timeout]
gcode:
    lights_off
    STATUS_OFF
    TURN_OFF_HEATERS
    M84
timeout: 1200

[gcode_macro CANCEL_PRINT]
rename_existing: BASE_CANCEL_PRINT
gcode:
    M104 S0
    M140 S0
    M106 S0
    CLEAR_PAUSE
    M84
    STATUS_OFF
    BASE_CANCEL_PRINT

[gcode_macro DISABLE_MOTORS]
gcode:
    M18

[gcode_macro START_PRINT]
gcode:
   {% set bed_temp = params.BED_TEMP|default(60)|float %} #[first_layer_bed_temperature]
   {% set extruder_temp = params.EXTRUDER_TEMP|default(190)|float %} #[first_layer_temperature]
    lights_on
    STATUS_HEATING     # Start bed heating
    M190 S{bed_temp}
    M104 S155
    G90 # Use absolute coordinates
    STATUS_HOMING
    G28     # Home the printer
    BED_MESH_CALIBRATE
    DOCK_PROBE
    STATUS_BUSY
    G1 X0.5 Y0 Z5 F6000 # Move the nozzle near the bed
    G1 Z0.15 F300 # Move the nozzle very close to the bed
    STATUS_HEATING
    M109 S{extruder_temp} # Set and wait for nozzle to reach temperature
    STATUS_PRINTING


[gcode_macro END_PRINT]
gcode:
    # Turn off bed, extruder, and fan
    M140 S0
    M104 S0
    M106 S0
    # Move nozzle away from print while retracting
    G91
    G1 X-2 Y-2 E-1 F300
    triple_beep
    # Raise nozzle by 0mm
    G1 Z20 F3000
    G90
    G1 X245 Y200
    # Disable steppers
    M84
    STATUS_OFF
    # SET_GCODE_OFFSET Z=0.0 # Reset the G-Code Z offset (adjust Z offset if needed)

######################################################################
# Debugging Macros
######################################################################

[gcode_macro DUMP_VARS]
gcode:
   {% for name1 in printer %}
      {% for name2 in printer[name1] %}
         { action_respond_info("printer['%s'].%s = %s" % (name1, name2, printer[name1][name2])) }
      {% endfor %}
   {% endfor %}

[gcode_macro DUMP_CONFIG_VARS]
gcode:
   {% for name1 in printer['configfile'].config %}
      #{% for name2 in printer[name1] %}
         { action_respond_info("printer['configfile'].%s" % (name1)) }
      #{% endfor %}
   {% endfor %}

######################################################################
# Filament Change
######################################################################


# M600: Filament Change. This macro will pause the printer, move the
# tool to the change position, and retract the filament 130mm. Adjust
# the retraction settings for your own extruder. After filament has
# been changed, the print can be resumed from its previous position
# with the "RESUME" gcode.

[gcode_macro M600]
gcode:
        {% set x = params.X|default(20)|float %} #park position
        {% set y = params.Y|default(0)|float %} #park position
        {% set z = params.Z|default(10)|float %} #park position
        {% set e = params.E|default(-40)|float %} #retract dist
        SAVE_GCODE_STATE NAME=M600_state
        PAUSE
        G91
        G1 E-5 F4000
        G1 Z{z}
        G90
        G1 X{x} Y{y} F3000        ;park position
        G91
        G0 E10 F500                ;extrude filament to get better blob on end
        G0 E{e} F600             ;retract additional filament to move out of melt zone
        G92 E0
        G90
        blur

#    Use this command resume during a mid print filament swap (DONT USE OCTO/MAINSAIL/DWC RESUME)
[gcode_macro SWAP_RESUME] 
gcode:
    RESTORE_GCODE_STATE NAME=M600_state
    resume

######################################################################
# load / unload filament
######################################################################


#    Macro to Load Filament
[gcode_macro load_filament]
gcode:
      {% set extruder = params.EXTRUDER|default(200)|float %}
      {% set x = params.X|default(-134)|float %}
      {% set y = params.Y|default(0)|float %}
      {% set z = params.Z|default(10)|float %}
      {% set e = params.E|default(30)|float %}   
      G90
      G0 X{x} Y{y}                #move to area where you can easily load filament
      M109 S{extruder}            #set hotend temperature and wait
      M83                         #relative positioning on extruder    
      G0 E{e} F400                #prime extruder
      G92 E0

#    Macro to Unload Filament
[gcode_macro unload_filament]

gcode:
      {% set extruder = params.EXTRUDER|default(200)|float %}
      {% set x = params.X|default(-134)|float %}
      {% set y = params.Y|default(0)|float %}
      {% set z = params.Z|default(10)|float %}
      {% set e = params.E|default(-30)|float %}
      G0 X{X} Y{Y}                #move to area where you can easily load filament
      M109 S{EXTRUDER}            #set hotend temperature and wait    
      M83                         #relative positioning on extruder
      G0 E15 F400                 #extrude filament to get better blob on end
      G0 E{E} F1000               #retract additional filament to move out of melt zone
      G92 E0